# Generated by cynkrathis::use_gitpod(), do not edit by hand
#
# Call:
# quote(cynkrathis::use_gitpod())

tasks:
  - name: dependencies
    init: |
      # Set up rig
      curl -Ls https://github.com/r-lib/rig/releases/download/latest/rig-linux-latest.tar.gz | sudo tar xz -C /usr/local

      # Set up R
      rig install
      rig system add-pak
      rig system make-links
      rig system setup-user-lib

      # Deps
      sudo apt install -y ccache cmake

      # Scriptlets, with custom Git config
      mv ~/.gitconfig ~/.gitconfig.gitpod
      curl -s https://raw.githubusercontent.com/krlmlr/scriptlets/master/bootstrap | sh

      ## .editorconfig
      ln -s ~/.editorconfig ..

      ## Set up ccache
      ln -s /usr/lib/ccache/* ~/bin/

      ## Work around glitch with non-systemd systems
      ln -s $(which true) ~/bin/timedatectl

      ## Define PATH
      # FIXME: Why is this necessary? This doesn't work in Radian.
      echo 'export PATH='${HOME}'/bin:${PATH}' >> ~/.bashrc

      # Set up Makevars
      mkdir -p ~/.R
      echo -e "MAKEFLAGS = -j8\nCXXFLAGS = -O0 -g" > ~/.R/Makevars

      # Install R packages
      echo 'options(repos = "https://packagemanager.rstudio.com/all/__linux__/'$(cat /etc/lsb-release | sed  -n '/DISTRIB_CODENAME=/ {s///;p}')'/latest")' >> ~/.Rprofile

      ## Install devtools and R dependencies
      R -q -e 'pak::pak(c("devtools", "languageserver", "styler")); pak::pak("deps::.", dependencies = TRUE)'

      # Install radian
      sudo pip install radian

vscode:
  extensions:
    - ms-vscode.cpptools
    # needs reload of VS Code to be operational
    - go2sh.cmake-integration-vscode
    # buggy -- doesn't reliably interpret include files?
    # observed behavior: repeated saving of src/CMakeLists.txt
    # changes detaction of include files -- sometimes it works, sometimes it doesn't,
    # with no detectable pattern
    # - ms-vscode.cmake-tools
    - EditorConfig.EditorConfig
    - REditorSupport.r
